{% extends "base.html" %}

{% block content %}

  <div class="row">

    <div>
      <h2>Temperature</h2>

        <div id="temperature_y_axis"></div>
        <div id="temperature_chart"></div>
        <div id="temperature_legend"></div>

   </div>

    <div>
      <h2>Humidity</h2>

        <div id="humidity_y_axis"></div>
        <div id="humidity_chart"></div>
        <div id="humidity_legend"></div>

   </div>

    <div>
      <h2>Electricity</h2>

        <div id="electricity_y_axis"></div>
        <div id="electricity_chart"></div>
        <div id="electricity_legend"></div>

   </div>

    <div class="col-md-4">
      <h2>Total Watts</h2>

        <div id="total_watts_y_axis"></div>
        <div id="total_watts_chart"></div>
        <div id="total_watts_legend"></div>

   </div>

  </div>

{% endblock %}

{% block js %}

<script type="text/javascript">

$(function(){

    var tv = 500;


    var graph_factory = function(id, start, end){

        var url = '/data/' + id + '/' + start + '/' + end + '/'

        d3.json(url, function(json) {

            json = json.data;

            $.each(json, function(x, dict){
                dict.scale = d3.scale.linear().domain([dict.min, dict.max]).nice();
                $.each(dict.data, function(y, point){
                    point.x = Date.parse(point.x) / 1000;
                });
            });

            var graph = new Rickshaw.Graph({
                element: document.getElementById(id + "_chart"),
                width: 690,
                height: 160,
                renderer: 'multi',
                series: json,
                interpolation: 'linear',
            });

            var x_axis = new Rickshaw.Graph.Axis.Time({
                graph: graph
            });
            var y_axis = new Rickshaw.Graph.Axis.Y.Scaled({
                graph: graph,
                tickFormat: Rickshaw.Fixtures.Number.formatKMBT,
                scale: json[0].scale
            });
            var y_axis = new Rickshaw.Graph.Axis.Y.Scaled({
                graph: graph,
                tickFormat: Rickshaw.Fixtures.Number.formatKMBT,
                scale: json[1].scale
            });

            var hoverDetail = new Rickshaw.Graph.HoverDetail( {
                graph: graph
            } );

            graph.render();


        })

    }

    var s = "2014-03-26%2000:00";
    var e = "2014-03-27%2000:00";

    graph_factory("temperature", s, e);
    graph_factory("humidity", s, e);
    graph_factory("electricity", s, e);
    //graph_factory("total_watts", s, e);

});


</script>

{% endblock %}
